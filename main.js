/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e=document.querySelector(".popup_type_image"),t=document.querySelector(".popup_type_add-card"),n=document.querySelector(".popup_type_profile"),r=document.querySelector(".popup_type_avatar-edit"),o=document.querySelector(".popup_type_delete"),a=document.querySelector("#profile-edit"),c=document.querySelector("#add-card"),i=document.querySelector(".profile__avatar"),u=document.querySelector(".profile__title"),l=document.querySelector(".profile__subtitle"),s=document.querySelector(".places"),d=n.querySelector('input[name="name"]'),m=n.querySelector('input[name="subname"]'),p=n.querySelector('form[name="profile-set"]'),f=t.querySelector('input[name="image-name"]'),v=t.querySelector('input[name="url"]'),_=t.querySelector('form[name="card-set"]'),y=e.querySelector(".popup__title"),S=e.querySelector(".popup__picture"),q=r.querySelector('input[name="url"]'),h=r.querySelector('form[name="avatar-set"]'),L=o.querySelector('form[name="delete-form"]');function C(e){return e.querySelector(".form__submit")}function E(e){e.classList.add("popup_opened"),document.addEventListener("keydown",k)}function b(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",k)}function k(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&b(t)}}function x(e,t,n){n?(e.classList.add(t),e.disabled=!0):(e.classList.remove(t),e.disabled=!1)}Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("click",(function(t){(t.target===e||t.target.classList.contains("popup__close"))&&b(e)}))}));var j,g,P,D,T,A,G,w="".concat("https://mesto.nomoreparties.co","/v1/").concat("plus-cohort-8","/"),B=function(e,t,n){var r={authorization:"749be577-3087-4ee3-ace3-b4e48a9a8c49","Content-Type":"application/json"},o={jsonGet:{method:"GET",headers:r},jsonPatch:{method:"PATCH",headers:r},jsonPost:{method:"POST",headers:r},jsonDelete:{method:"DELETE",headers:r},jsonPut:{method:"PUT",headers:r}};return n&&(o[t].body=JSON.stringify(n)),fetch(w+e,o[t]).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))},H="4d7df922d9711d87040b3058";function M(t,n,r,a,c,i){var u=document.querySelector("#place-template").content.cloneNode(!0),l=u.querySelector(".place"),s=u.querySelector(".place__title"),d=u.querySelector(".place__image");s.textContent=t,d.src=n,d.alt=r||t;var m=l.querySelector(".place__like"),p=l.querySelector(".place__like-count");if(i&&(p.textContent=i.length,0===i.length&&(p.textContent=""),i.length>0&&i.find((function(e){return e._id===H}))&&m.classList.add("place__like_active")),m.addEventListener("click",(function(){m.classList.toggle("place__like_active");var e=m.classList.contains("place__like_active")?"jsonPut":"jsonDelete";B("cards/likes/".concat(a),e).then((function(){B("cards","jsonGet").then((function(e){var t=e.find((function(e){return e._id===a}));p.textContent=t.likes.length}))}))})),c===H){var f=l.querySelector(".place__trash");f.style.display="block",f.addEventListener("click",(function(){E(o),L.addEventListener("submit",(function(e){e.preventDefault();var t=C(o);t.textContent="Удаление...",o.addEventListener("submit",(function e(n){var r=n.currentTarget.params;B("cards/".concat(r),"jsonDelete").then((function(){l.remove(),b(o),t.textContent="Удалить",o.removeEventListener("submit",e)}))})),o.params=a,b(o)}))}))}return d.addEventListener("click",(function(){S.src=d.src,S.alt=d.alt,y.textContent=s.textContent,E(e)})),u}_.addEventListener("submit",(function(e){e.preventDefault();var n=C(_);n.textContent="Сохранение...",B("cards","jsonPost",{name:f.value,link:v.value}).then((function(e){var r=M(e.name,e.link,e.name,e._id,e.owner._id,e.likes);s.prepend(r),b(t),_.reset(),x(n,"form__submit_disabled",!0)}))})),p.addEventListener("submit",(function(e){e.preventDefault();var t=C(p);t.textContent="Сохранение...",u.textContent=d.value,l.textContent=m.value,B("users/me","jsonPatch",{name:d.value,about:m.value}).then((function(){t.textContent="Сохранить",b(n)}))})),r.addEventListener("submit",(function(e){e.preventDefault();var t=C(r);t.textContent="Сохранение...",B("users/me/avatar","jsonPatch",{avatar:q.value}).then((function(){i.src=q.value,b(r),t.textContent="Сохранить",h.reset()}))})),B("users/me","jsonGet").then((function(e){u.textContent=e.name,l.textContent=e.about,i.src=e.avatar})),g=(j={formSelector:".form",inputSelector:".form__field",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_disabled",inputErrorClass:"form__field_invalid",errorClass:"form__field-error_active"}).formSelector,P=j.inputSelector,D=j.submitButtonSelector,T=j.inactiveButtonClass,A=j.inputErrorClass,G=j.errorClass,Array.from(document.querySelectorAll(g)).forEach((function(e){var t=Array.from(e.querySelectorAll(P)),n=e.querySelector(D);x(n,T,t.some((function(e){return!e.validity.valid}))),t.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n,r){t.validity.valid?function(e,t,n,r){t.classList.remove(n);var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove(r),o.textContent=""}(e,t,n,r):function(e,t,n,r,o){t.classList.add(r);var a=e.querySelector(".".concat(t.id,"-error"));a.classList.add(o),a.textContent=n}(e,t,t.validationMessage,n,r)}(e,r,A,G),x(n,T,t.some((function(e){return!e.validity.valid})))}))}))})),a.addEventListener("click",(function(){d.value=u.textContent,m.value=l.textContent,E(n)})),c.addEventListener("click",(function(){E(t)})),i.addEventListener("click",(function(){E(r)})),B("cards","jsonGet").then((function(e){var t;t=e,s.innerHTML="",t.forEach((function(e){s.append(M(e.name,e.link,e.name,e._id,e.owner._id,e.likes))}))}))})();